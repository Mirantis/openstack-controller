{%- from 'macros/connections.j2' import to_child_object %}
heat:
  CronJob:
    heat-db-purge:
      hash_fields: []
      images:
      - heat_db_purge
      manifest: cron_job_db_purge
      pod_labels:
        application: heat
        component: db-purge
    heat-engine-cleaner:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_engine_cleaner
      manifest: cron_job_engine_cleaner
      pod_labels:
        application: heat
        component: engine-cleaner
  Deployment:
    heat-api:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_api
      manifest: deployment_api
      pod_labels:
        application: heat
        component: api
    heat-cfn:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_cfn
      manifest: deployment_cfn
      pod_labels:
        application: heat
        component: cfn
    heat-cloudwatch:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_cloudwatch
      manifest: deployment_cloudwatch
      pod_labels:
        application: heat
        component: cloudwatch
    heat-engine:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_engine
      manifest: deployment_engine
      pod_labels:
        application: heat
        component: engine
  Job:
    heat-bootstrap:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields:
      - network.proxy.*
      - bootstrap.*
      images:
      - bootstrap
      manifest: job_bootstrap
      pod_labels:
        application: heat
        component: bootstrap
    heat-db-drop:
      hash_fields:
      - endpoints.oslo_db.*
      images:
      - db_drop
      manifest: job_db_drop
      pod_labels:
        application: heat
        component: db-drop
    heat-db-init:
      hash_fields:
      - endpoints.oslo_db.*
      images:
      - db_init
      manifest: job_db_init
      pod_labels:
        application: heat
        component: db-init
    heat-db-sync:
      hash_fields:
      - endpoints.oslo_db.*
      images:
      - heat_db_sync
      manifest: job_db_sync
      pod_labels:
        application: heat
        component: db-sync
    heat-domain-ks-user:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields:
      - conf.*
      - endpoints.*
      images:
      - ks_user
      manifest: job_ks_user_domain
      pod_labels:
        application: heat
        component: ks-user
    heat-ks-endpoints:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - ks_endpoints
      manifest: job_ks_endpoints
      pod_labels:
        application: heat
        component: ks-endpoints
    heat-ks-service:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - ks_service
      manifest: job_ks_service
      pod_labels:
        application: heat
        component: ks-service
    heat-ks-user:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields:
      - endpoints.*
      images:
      - ks_user
      manifest: job_ks_user
      pod_labels:
        application: heat
        component: ks-user
    heat-trustee-ks-user:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields:
      - endpoints.*
      images:
      - ks_user
      manifest: job_ks_user_trustee
      pod_labels:
        application: heat
        component: ks-user
    heat-trusts:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields:
      - conf.*
      images:
      - ks_trusts
      manifest: job_heat_trusts
      pod_labels:
        application: heat
        component: trusts
  StatefulSet:
    heat-engine:
      connections:
        egress:
          - {{ to_child_object("identity", "keystone", "Deployment", "keystone-api", ["ks-pub"]) | indent(12)}}
      hash_fields: []
      images:
      - heat_engine
      manifest: deployment_engine
      pod_labels:
        application: heat
        component: engine
rabbitmq:
  Job:
    openstack-heat-rabbitmq-cluster-wait:
      hash_fields:
      - endpoints.oslo_messaging.*
      images:
      - rabbitmq_scripted_test
      manifest: job_cluster_wait
