#apiVersion: lcm.mirantis.com/v1alpha1
#kind: HelmBundle

{%- set service = 'drb-controller' %}
{%- set keystone_users =  spec.features.get('keystone', {}).get('users', {}) %}
spec:
  releases:
  - name: openstack-drb-controller
    chart: {{spec.common.infra.repo}}/drb-controller
    values:
      images:
        tags:
{%- for image in [
    "drb_controller",
    ] %}
        {%- if image in images %}
          {{ image }}: {{ images[image] }}
        {%- endif %}
{%- endfor %}
      endpoints:
        cluster_domain_suffix: {{ spec.internal_domain_name }}
        identity:
          auth:
            drb-controller:
              region_name: {{ spec.get('region_name', 'RegionOne') }}
              username: {{ keystone_creds["drb_controller"].username }}
              password: {{ keystone_creds["drb_controller"].password }}
              project_name: {{ keystone_users.get('admin', {}).get('project_name', 'admin') }}
              user_domain_name: {{ keystone_users.get('admin', {}).get('user_domain_name', 'default') }}
              project_domain_name: {{ keystone_users.get('admin', {}).get('project_domain_name', 'default') }}
              default_domain_id: {{ keystone_users.get('admin', {}).get('default_domain_id', 'default') }}
          hosts:
            admin:
              host: keystone-api
            default: keystone
            internal: keystone-api
          port:
            api:
              admin: 5000
              default: 80
              internal: 5000
              public: 443
          scheme:
            default: http
            public: https
      manifests:
        job_ensure_resources: false
        configmap_deploy_resources: false
